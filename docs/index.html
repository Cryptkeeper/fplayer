<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fplayer: fplayer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">fplayer
   </div>
   <div id="projectbrief">C99 Falcon Sequence (fseq) file player for Light-O-Rama hardware (like xLights)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">fplayer </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p>A cross-platform C99 <a href="http://github.com/Cryptkeeper/fseq-file-format">fseq file</a> player (like <a href="http://github.com/smeighan/xLights">xLights</a> and <a href="https://github.com/FalconChristmas/fpp">Falcon Player/fpp</a>) for <a href="https://lightorama.com">Light-O-Rama</a> hardware. This project is a way for me to explore solutions to a better version of my previous project, <a href="https://github.com/Cryptkeeper/libreorama">libreorama</a>.</p>
<p>Use <code>fplayer -h</code> to show program usage and get started.</p>
<p>You'll need an fseq file of your choosing, and its audio file (if any). You may attach a Light-O-Rama device (note its serial port device name or list available serial ports with <code>fplayer -l</code>), but it is not required for the program to playback a sequence. A default channel map is included (<code>channels.json</code>) for use with <code>-c</code> (<code>-c=channels.json</code>), but you will likely want to modify it in the future.</p>
<div class="fragment"><div class="line">Usage: fplayer -f=FILE -c=FILE [options] ...</div>
<div class="line"> </div>
<div class="line">Options:</div>
<div class="line"> </div>
<div class="line">[Playback]</div>
<div class="line">    -f &lt;file&gt;       FSEQ v2 sequence file path (required)</div>
<div class="line">    -c &lt;file&gt;       Network channel map file path (required)</div>
<div class="line">    -d &lt;device name|stdout&gt; Device name for serial port connection</div>
<div class="line">    -b &lt;baud rate&gt;      Serial port baud rate (defaults to 19200)</div>
<div class="line"> </div>
<div class="line">[Controls]</div>
<div class="line">    -a &lt;file&gt;       Override audio with specified filepath</div>
<div class="line">    -w &lt;seconds&gt;            Playback start delay to allow connection setup</div>
<div class="line"> </div>
<div class="line">[CLI]</div>
<div class="line">    -t &lt;file&gt;       Test load channel map and exit</div>
<div class="line">    -l          Print available serial port list and exit</div>
<div class="line">    -h          Print this message and exit</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1"></a>
What's Included</h1>
<ul>
<li>Precise frame timing with automatic frame loss recovery</li>
<li>Protocol minifier for reduced bandwidth usage</li>
<li>"Frame pump" mechanism for pre-buffering upcoming frames</li>
<li>Support for zstd compressed sequences</li>
<li>Options for modifying playback speed and audio</li>
</ul>
<p>All in a small package. Most of fplayer's resource usage originates from audio file decoding and playback.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Dependencies</h1>
<p>fplayer offloads deserialization and encoding work to my other libraries, <a href="https://github.com/Cryptkeeper/libtinyfseq">libtinyfseq</a> and <a href="https://github.com/Cryptkeeper/libtinylor">libtinylor</a>. Both are provided as git submodules and are built locally via the CMake build configuration. You do not need to install these.</p>
<p>You must provide: cJSON, libserialport, OpenAL, an ALUT-compatible library, and zstd.</p>
<p>I have included a few package manager commands below to install the dependencies. You can definitely build it on other platforms, but you'll be responsible for ensuring the dependencies are found and linked.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
macOS (Homebrew)</h2>
<div class="fragment"><div class="line">install cjson libserialport freealut zstd</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Ubuntu</h2>
<div class="fragment"><div class="line">-get install -y libcjson-dev libopenal-dev libalut-dev libserialport-dev libzstd-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
FreeBSD</h2>
<div class="fragment"><div class="line">install -y libcjson openal-soft freealut libserialport zstd</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Setup</h1>
<ol type="1">
<li>Clone the repository and its submodules: <code>git clone --recursive git@github.com:Cryptkeeper/fplayer.git</code></li>
<li>Configure the CMake project with <code>cmake -B build -DCMAKE_BUILD_TYPE=RelWithDebugInfo</code><ul>
<li>macOS users with the dependencies provided via Homebrew should append <code>-DCMAKE_PREFIX_PATH=$(brew --prefix)</code></li>
<li>FreeBSD users may need to append <code>-DCMAKE_PREFIX_PATH=/usr/local</code> to correctly link with system libraries</li>
</ul>
</li>
<li>Compile the project with <code>cmake --build build</code></li>
<li>(Optional) Run CTests with <code>cd build &amp;&amp; ctest .</code></li>
</ol>
<p>fplayer can be compiled using (at least) clang and gcc.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Artifacts</h1>
<p>macOS, Ubuntu and Windows build downloads are available as artifacts via <a href="https://github.com/Cryptkeeper/fplayer/actions">GitHub Actions</a>.</p>
<p>FreeBSD is generally supported, although the build is not automated due to GitHub Actions' lack of support in its Action Runner.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Tests &amp; Sanitizers</h1>
<p>Test coverage is provided by CTest for components of fplayer and most of the libraries supporting it (libtinyfseq, liblorproto, and the repo-specific common library).</p>
<p>GitHub Actions workflows provide sanitizer coverage using <a href="https://github.com/google/sanitizers">AddressSanitizer and UBSan</a> and/or <a href="https://valgrind.org">Valgrind</a> (depending on the toolchain). You may enable any of the sanitizers in your CMake build using <code>-DUSE_ASAN=ON</code> and/or <code>-DUSE_UBSAN=ON</code>.</p>
<p><a href="https://llvm.org/docs/LibFuzzer.html">libFuzzer</a> is used to provide basic fuzzing coverage for the fseq file format parsing library used by fplayer, <a href="https://github.com/Cryptkeeper/libtinyfseq">libtinyfseq</a>.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Channel Maps</h1>
<p>In order to map the channel data from an fseq file to your real-life hardware network, fplayer requires you to configure a channel map: fseq files provide a 0-indexed array of frame data, each key a "channel", and the interpreting program is responsible for passing off its value ("brightness") to the corresponding device I/O driver.</p>
<p>The main consumers of the fseq file format (e.g. xLights and Falcon Player) accomplish this via a lookup operation using additional context provided by your "show directory" files. fplayer could try to parse that data and re-use it, but I don't want the complexity or the hard dependency. Instead, you provide your own lookup map by writing a basic JSON structure and providing the path as an argument to fplayer. As a bonus feature, this also means the value of a given FSEQ "channel" can be changed at program start to any value of your choice. This means you can rearrange existing sequences without modifying anything but the channel map.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Example</h2>
<p>A channel map is saved in a <code>.json</code> file. For example, the following channel map defines 32 channels from the fseq file, mapping the output to two banks of 16 channels on two different LOR hardware units attached to the network.</p>
<div class="fragment"><div class="line">[</div>
<div class="line">   {</div>
<div class="line">      &quot;index&quot;: {</div>
<div class="line">         &quot;from&quot;: 0,</div>
<div class="line">         &quot;to&quot;: 15</div>
<div class="line">      },</div>
<div class="line">      &quot;circuit&quot;: {</div>
<div class="line">         &quot;from&quot;: 1,</div>
<div class="line">         &quot;to&quot;: 16</div>
<div class="line">      },</div>
<div class="line">      &quot;unit&quot;: 1</div>
<div class="line">   },</div>
<div class="line">   {</div>
<div class="line">      &quot;index&quot;: {</div>
<div class="line">         &quot;from&quot;: 16,</div>
<div class="line">         &quot;to&quot;: 31</div>
<div class="line">      },</div>
<div class="line">      &quot;circuit&quot;: {</div>
<div class="line">         &quot;from&quot;: 17,</div>
<div class="line">         &quot;to&quot;: 32</div>
<div class="line">      },</div>
<div class="line">      &quot;unit&quot;: 2</div>
<div class="line">   }</div>
<div class="line">]</div>
</div><!-- fragment --><p>The <code>index</code> and <code>circuit</code> objects define the range of channels to map from the FSEQ file to the LOR hardware. The <code>unit</code> value is the LOR hardware unit number to send the data to. The <code>from</code> and <code>to</code> values are inclusive, so the first row maps FSEQ channels 0-15 to LOR channels 1-16 on unit 1. The second row maps FSEQ channels 16-31 to LOR channels 17-32 on unit 2.</p>
<p>The length of each range must match, and fplayer will print an error at start if they do not. There is no requirement for mappings to be sequential, contiguous or cover the full fseq channel space. You can also map multiple fseq channels to the same LOR hardware channel. Any channels that are not mapped will not have any data written to them at runtime, so you don't have to worry about deleting/blank the unused channels. fplayer will print a status message when starting to notify you of any missing channel mappings.</p>
<p>The included <code>channels.json</code> default simply maps the first 16 FSEQ channels to the first 16 channels of any connected LOR unit. This is likely what most people with AC LOR units are looking for. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
